<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zzhb.zzoa.mapper.JournalMapper">
    <select id="getMyJournalInfo" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        a.j_id,
        a.today_work_content,
        a.attachment_id,
        a.submit_time,
        a.receiver,
        a.unfinished_work,
        a.coordinated_work,
        a.uniqueid
        FROM aff_t_journal a
        <where>
            <if test="submitter != null and submitter != ''">
                AND a.submitter = #{submitter}
            </if>
            <if test="submit_time != null and submit_time != ''">
                AND a.submit_time = #{submit_time}
            </if>
            <if test="username != null and username != ''">
                <bind name="_username" value="'%'+username+'%'"/>
                AND b.username like #{_username}
            </if>
        </where>
        order by a.submit_time desc
    </select>

    <select id="getDistinctId" resultType="java.util.Map">
        SELECT DISTINCT
        uniqueid
        FROM aff_t_journal
    </select>

    <select id="getDistinctJournal" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        *
        FROM aff_t_journal a
        <where>
            <if test="uniqueid != null and uniqueid != ''">
                AND a.uniqueid = #{uniqueid}
            </if>
        </where>
    </select>

    <select id="getReceivers" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        a.receiver
        FROM aff_t_journal a
        <where>
            <if test="uniqueid != null and uniqueid != ''">
                AND a.uniqueid = #{uniqueid}
            </if>
        </where>
    </select>

    <select id="getRecname" resultType="java.lang.String" parameterType="java.util.Map">
        SELECT
        username
        FROM sys_t_user
        <where>
            <if test="u_id != null and u_id != ''">
                AND u_id = #{u_id}
            </if>
        </where>
    </select>


    <select id="getSubmit" resultType="java.lang.String" parameterType="java.util.Map">
        SELECT
        a.username
        FROM sys_t_user a,aff_t_journal b
        <where>
            and a.u_id = b.submitter
            <if test="uniqueid != null and uniqueid != ''">
                AND b.uniqueid = #{uniqueid}
            </if>
        </where>
    </select>

    <select id="getAttIds" resultType="java.lang.String" parameterType="java.util.Map">
        SELECT
        attachment_id
        FROM aff_t_journal
        <where>
            <if test="uniqueid != null and uniqueid != ''">
                AND uniqueid = #{uniqueid}
            </if>
        </where>
    </select><select id="getAtt" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        attach_id,
        attach_name,
        attach_type,
        createtime,
        url
        FROM aff_t_attachment
        <where>
            <if test="attach_id != null and attach_id != ''">
                AND attach_id = #{attach_id}
            </if>
        </where>
    </select>

    <!--<delete id="delCarById" parameterType="java.util.Map">-->
        <!--DELETE FROM aff_car_info-->
        <!--<where>-->
            <!--<if test="c_id != null and c_id != ''">-->
                <!--c_id = #{c_id}-->
            <!--</if>-->
        <!--</where>-->
    <!--</delete>-->

    <insert id="addNewJournal" keyProperty="c_id" useGeneratedKeys="true" parameterType="java.util.Map" >
        INSERT INTO aff_t_journal(today_work_content,attachment_id,submitter,submit_time,receiver,unfinished_work,coordinated_work,uniqueid)
        VALUES (#{today_work_content},#{attachment_id},#{submitter},now(),#{receiver},#{unfinished_work},#{coordinated_work},#{uniqueid})
    </insert>

    <select id="getReceiveJour" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        a.*
        FROM aff_t_journal a
        <where>
            <if test="receiver != null and receiver != ''">
                AND a.receiver = #{receiver}
            </if>
        </where>
    </select>

    <!--<update id="editCar" parameterType="java.util.Map">-->
        <!--UPDATE aff_car_info-->
        <!--<set>-->
            <!--<if test="car_model != null and car_model !='' ">-->
                <!--car_model = #{car_model},-->
            <!--</if>-->
            <!--<if test="car_card != null and car_card !='' ">-->
                <!--car_card = #{car_card},-->
            <!--</if>-->
            <!--<if test="car_type != null and car_type !=''">-->
                <!--car_type = #{car_type},-->
            <!--</if>-->
            <!--<if test="car_limit != null and car_limit !='' ">-->
                <!--car_limit = #{car_limit},-->
            <!--</if>-->
            <!--<if test="buy_time != null and buy_time !='' ">-->
                <!--buy_time = #{buy_time},-->
            <!--</if>-->
            <!--<if test="kilometres != null and kilometres !='' ">-->
                <!--kilometres = #{kilometres},-->
            <!--</if>-->
            <!--<if test="next_inspection_time != null and next_inspection_time !='' ">-->
                <!--next_inspection_time = #{next_inspection_time},-->
            <!--</if>-->
            <!--<if test="car_status != null and car_status !='' ">-->
                <!--car_status = #{car_status},-->
            <!--</if>-->
        <!--</set>-->
        <!--<where>-->
            <!--<if test="c_id != null and c_id !='' ">-->
                <!--AND c_id = #{c_id}-->
            <!--</if>-->
        <!--</where>-->
    <!--</update>-->

    <!--<select id="getCarUsageInfo" resultType="java.util.Map" parameterType="java.util.Map">-->
        <!--SELECT c.v_id,-->
        <!--c.c_id,-->
        <!--a.car_model,-->
        <!--a.car_card,-->
        <!--a.car_limit,-->
        <!--c.apply_date,-->
        <!--c.u_id,-->
        <!--b.username,-->
        <!--c.dispatching_department,-->
        <!--c.driver,-->
        <!--c.out_time,-->
        <!--c.back_time,-->
        <!--c.out_mileage,-->
        <!--c.back_mileage,-->
        <!--c.route,-->
        <!--c.dispatch_reason-->
        <!--FROM aff_car_info a,sys_t_user b,aff_vehicle_usage_statistics c-->
        <!--<where>-->
            <!--<if test="c_id != null and c_id !='' ">-->
                <!--AND a.c_id = #{c_id}-->
            <!--</if>-->
            <!--AND a.c_id = c.c_id AND b.u_id = c.u_id-->
            <!--<if test="car_model != null and car_model != ''">-->
                <!--<bind name="_car_model" value="'%'+car_model+'%'"/>-->
                <!--AND a.car_model like #{_car_model}-->
            <!--</if>-->
            <!--<if test="car_card != null and car_card != ''">-->
                <!--<bind name="_car_card" value="'%'+car_card+'%'"/>-->
                <!--AND a.car_card like #{_car_card}-->
            <!--</if>-->
            <!--<if test="car_limit != null and car_limit != ''">-->
                <!--AND a.car_limit = #{_car_limit}-->
            <!--</if>-->
        <!--</where>-->
    <!--</select>-->

    <!--<update id="updateUserByUser" parameterType="com.zzhb.zzoa.domain.User">-->
    <!--UPDATE sys_t_user-->
    <!--<set>-->
    <!--<if test="nickname != null and nickname !='' ">-->
    <!--nickname = #{nickname},-->
    <!--</if>-->
    <!--<if test="true">-->
    <!--updatetime = now(),-->
    <!--</if>-->
    <!--<if test="remark != null">-->
    <!--remark = #{remark},-->
    <!--</if>-->
    <!--<if test="email != null">-->
    <!--email = #{email},-->
    <!--</if>-->
    <!--<if test="phone != null">-->
    <!--phone = #{phone},-->
    <!--</if>-->
    <!--<if test="status != null and status !='' ">-->
    <!--status = #{status}-->
    <!--</if>-->
    <!--</set>-->
    <!--<where>-->
    <!--<if test="u_id != null and u_id !='' ">-->
    <!--AND u_id = #{u_id}-->
    <!--</if>-->
    <!--</where>-->
    <!--</update>-->

    <!--<update id="updateUserRole" parameterType="java.util.Map">-->
    <!--UPDATE sys_t_user_role-->
    <!--<set>-->
    <!--<if test="r_id != null and r_id !='' ">-->
    <!--r_id = #{r_id}-->
    <!--</if>-->
    <!--</set>-->
    <!--<where>-->
    <!--<if test="u_id != null and u_id !='' ">-->
    <!--AND u_id = #{u_id}-->
    <!--</if>-->
    <!--</where>-->
    <!--</update>-->

    <!--<insert id="addUrole" parameterType="java.util.Map">-->
    <!--INSERT INTO sys_t_user_role(u_id,r_id)-->
    <!--VALUES (#{u_id},#{r_id})-->
    <!--</insert>-->


    <!--<update id="resetPass" parameterType="java.util.Map">-->
    <!--UPDATE sys_t_user-->
    <!--<set>-->
    <!--<if test="password != null and password !='' ">-->
    <!--password = #{password}-->
    <!--</if>-->
    <!--</set>-->
    <!--<where>-->
    <!--<if test="u_id != null and u_id !='' ">-->
    <!--AND u_id = #{u_id}-->
    <!--</if>-->
    <!--</where>-->
    <!--</update>-->

</mapper>