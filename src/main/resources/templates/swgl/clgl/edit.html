<#assign ctx=req.contextPath />
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link href="${ctx}/plugins/layui/css/layui.css" rel="stylesheet"/>
    <link href="${ctx}/plugins/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <style>
        /* layui重置 */
        .layui-form {
            width: 530px;
            margin: 10px auto 0;
        }

        .layui-form-item .layui-inline, .layui-form-item .layui-input-block {
            width: 400px;
        }

        .layui-form-item .radio-box {
            border: 1px solid #e6e6e6;
        }

        .layui-btn-container {
            width: 512px;
            text-align: center;
        }

        /* 自定义 */
        div.icon-box {
            height: 36px;
            border: 1px solid #e6e6e6;
            border-left: none;
            background-color: #fff;
            border-radius: 2px;
        }

        .icon-box .icon {
            width: 36px;
            height: 36px;
            text-align: center;
            line-height: 36px;
            border-right: 1px solid #e6e6e6;
            display: inline-block;
        }

        .icon-box .layui-inline-block {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .icon-box .icon-input {
            display: inline-block;
            border: none;
            flex-grow: 1;
            padding: 0 10px;
        }
    </style>
</head>
<body>

<form class="layui-form layui-form-pane" lay-filter="edit" action="/menus/update"
      style="position: absolute;top: 50%;left:50%;margin:-210px 0 0 -265px ;">
    <div class="layui-form-item">
        <!--<input type="hidden" value="${(echouser.status)!''}" name="status">-->
        <label class="layui-form-label">车型号:</label>
        <div class="layui-inline">
            <input class="layui-input" type="text" name="car_model" placeholder="车型号" lay-verify="required" value="${(car.car_model)!''}">
        </div>
    <label class="layui-form-label">车牌号:</label>
    <div class="layui-inline">
        <input class="layui-input" type="text" name="car_card" value="${(car.car_card)!''}" placeholder="车牌号"
               lay-verify="required">
    </div>
    <!--<label class="layui-form-label">车种类:</label>-->
    <!--<div class="layui-inline">-->
        <!--<input class="layui-input" type="text" name="car_type" id="car_type" placeholder="车种类">-->
    <!--</div>-->
        <label class="layui-form-label">车种类:</label>
        <div class="layui-inline">
            <select name="car_type" id="car_type" lay-search lay-verify="required">
                <#if map.flag == 'add'>
                <option value=""></option>
            </#if>
            </select>
        </div>
<label class="layui-form-label">乘坐人数:</label>
<div class="layui-inline">
    <input class="layui-input" type="number" name="car_limit" value="${(car.car_limit)!''}" placeholder="乘坐人数"
           lay-verify="required">
</div>
<label class="layui-form-label">购买时间:</label>
<div class="layui-inline">
    <input class="layui-input" type="text" name="buy_time" value="${(car.buy_time)!''}" placeholder="购买时间"
           id="buy_time" lay-verify="required">
</div>

<label class="layui-form-label">公里数:</label>
<div class="layui-inline">
    <input name="kilometres" lay-verify="required" placeholder="公里数" class="layui-input" type="number" value="${(car.kilometres)!''}"/>
</div>

        <label class="layui-form-label">下次年检时间:</label>
        <div class="layui-inline">
            <input name="next_inspection_time" lay-verify="required" id="next_inspection_time" placeholder="下次年检时间" class="layui-input" type="text" value="${(car.next_inspection_time)!''}"/>
        </div>

        <label class="layui-form-label">状态:</label>
        <div class="layui-inline">
            <select name="car_status" id="car_status" lay-search lay-verify="required">
                <option value=""></option>
            </select>
        </div>
</div>

<div class="layui-btn-container">
    <a class="layui-btn layui-btn-sm layui-btn-primary" lay-submit lay-filter="save">保存</a>
    <a id="cancel" class="layui-btn layui-btn-sm layui-bg-gray">取消</a>
</div>
</form>

<script src="${ctx}/plugins/layui/layui.js"></script>
<script type="text/javascript">

    layui.use(['form', 'layer', 'upload','laydate'], function () {
        var laydate = layui.laydate;
        laydate.render({
            elem: '#buy_time'
            ,type: 'datetime'
        });
        laydate.render({
            elem: '#next_inspection_time'
            ,type: 'datetime'
        });

        var $ = layui.jquery, treeSelect = layui.treeSelect, form = layui.form, layer = layui.layer;


            //车种类下拉框
            $.ajax({
                url: '${ctx}/swgl/clgl/listcartype',
                dataType: 'json',
                type: 'get',
                success: function (data) {
                    $.each(data.data, function (index, item) {
                        $('#car_type').append(new Option(item.type_info, item.t_id));// 下拉菜单里添加元素
                    });
                    if ('${(car.car_type)!''}' != ''){
                        $("#car_type").val('${(car.car_type)!''}');
                    }
                    layui.form.render("select");
                }
            })

        //车状态下拉框
        $.ajax({
            url: '${ctx}/swgl/clgl/getcarstatus',
            dataType: 'json',
            type: 'get',
            success: function (data) {
                $.each(data.data, function (index, item) {
                    $('#car_status').append(new Option(item.status_info, item.s_id));// 下拉菜单里添加元素
                });
                if ('${(car.car_status)!''}' != ''){
                    $("#car_status").val('${(car.car_status)!''}');
                }
                layui.form.render("select");
            }
        })


        form.on('submit(save)', function (data) {
            console.log(data);
            var url = "${ctx}/swgl/clgl/editCar";
            data.field.flag = '${map.flag}';
            data.field.c_id = '${(car.c_id)!''}';
            var index;
            $.ajax({
                type: "POST",
                data: data.field,
                url: url,
                beforeSend: function () {
                    index = layer.load(1);
                },
                success: function (data) {
                    layer.close(index);
                    if (data > 0) {
                        var msg = "保存成功";
                        layer.msg(msg, {offset: ['50%'], time: 1000}, function () {
                            index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        });
                    } else {
                        layer.msg("操作失败")
                    }
                },
                error: function (data) {
                    layer.msg("服务端异常");
                }
            });
            return false;
        });

        //取消
        $("#cancel").click(function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })
    })
</script>
</body>
</html>
