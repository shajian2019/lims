<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>弹出框</title>
    <link href="${ctx}/plugins/layui/css/layui.css" rel="stylesheet" />
    <link href="${ctx}/plugins/layui/extend//dtree/dtree.css" rel="stylesheet" />
    <link href="${ctx}/plugins/layui/extend/dtree/font/dtreefont.css" rel="stylesheet" />
    <style>
        .layui-form-item .layui-inline{min-width:260px;}
        /* zdy主题风格*/
        .dtree-zzfc-item-this{background-color: #c2c2c2!important;} /* 当前选中行样式*/
        .dtree-zzfc-item:hover{background-color: #f2f2f2!important;} /* 行悬停样式*/
        .dtree-zzfc-item cite{font-size:14px!important;} /* 行文字样式*/
        .dtree-zzfc-item:hover cite{color:#0a8cbf!important;} /* 行悬停文字样式*/
        .dtree-zzfc-dtreefont{font-size: 18px!important;} /* 一级图标、二级图标、复选框样式*/
        .dtree-zzfc-ficon{color:#2F4056!important;}  /*一级图标特定样式*/
        .dtree-zzfc-icon{color:#0a8cbf!important;}  /*二级图标特定样式*/
        .dtree-zzfc-checkbox:hover{color:#5FB878!important;}  /*复选框悬停样式*/
        .dtree-zzfc-choose{color:#5FB878!important;} /* 复选框选中样式*/
        /**/
        .red{color:red;}
        .layui-form-item {
            margin-bottom:5px;
            clear: both;
            *zoom: 1;
        }
        .form-left,.form-right{
            display: inline-block;
            height:345px;
            overflow: auto;
            width: 46%;
            margin-left: 2%;
            box-sizing: border-box;
        }
        .form-right{
            border:1px solid #e6e6e6;
            padding: 8px;
        }
        /*滚动条样式*/
        .form-right::-webkit-scrollbar {
            /*滚动条整体样式*/
            width: 4px;     
            /*高宽分别对应横竖滚动条的尺寸*/
            height: 4px;
        }
        .form-right::-webkit-scrollbar-thumb {
            /*滚动条里面小方块*/
            border-radius: 5px;
            -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
            background: rgba(0,0,0,0.2);
        }
        .form-right::-webkit-scrollbar-track {/*滚动条里面轨道*/
            -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
            border-radius: 0;
            background: rgba(0,0,0,0.1);
        }
        .layui-btn-container{
            text-align: center;
            margin-top: 10px;        }
    </style>
</head>
<body>
    <form class="layui-form layui-form-pane" style="margin-top:10px;">
    	<input type="hidden" name="r_id" value="${(jsglrole.r_id)!''}">
        <div class="form-left">
            <div class="layui-form-item">
                <label class="layui-form-label">角色名称</label>
                <div class="layui-inline">
                    <input class="layui-input" type="text" lay-verify="required" name="rolename" value="${(jsglrole.rolename)!''}">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">角色编码</label>
                <div class="layui-inline">
                    <input class="layui-input" type="text" lay-verify="required" name="rolecode" value="${(jsglrole.rolecode)!''}">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">状态</label>
                <div class="layui-input-inline">
                	<#if (flag == 'edit')>
	                    <input type="radio" name="status" value="1" title="正常" <#if jsglrole.status == '1'>checked</#if>>
	                    <input type="radio" name="status" value="0" title="禁用" <#if jsglrole.status == '0'>checked</#if>>
                    <#else>
	                    <input type="radio" name="status" value="1" title="正常" checked>
	                    <input type="radio" name="status" value="0" title="禁用" >
                    </#if>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">备注信息:</label>
                <div class="layui-inline">
                    <textarea name="remark" placeholder="请输入内容" class="layui-textarea">${(jsglrole.remark)!''}</textarea>
                </div>
            </div>
        </div>
        <div class="form-right">
            <p>功能菜单:</p>
            <ul id="dtree" class="dtree" data-id="0"></ul>
        </div>
        <div class="layui-btn-container">
            <a class="layui-btn layui-btn-sm layui-btn-primary" lay-submit lay-filter="save">保存</a>
            <a id="cancel" class="layui-btn layui-btn-sm layui-bg-gray">取消</a>
        </div>
    </form>
</body>

</html>
<script src="${ctx}/plugins/layui/layui.all.js"></script>
<script>
    layui.config({
        base: '${ctx}/plugins/layui/extend/dtree/'
    }).extend({
        dtree: 'dtree'
    });
    
    layui.use(['layer', 'form', 'table', 'dtree', 'element'], function () {
        var $ = layui.jquery,
            layer = layui.layer,
            table = layui.table,
            form = layui.form,
            dtree = layui.dtree;
        var dtreeId = 'dtree';
        
        var DemoTree = dtree.render({
            elem: '#'+dtreeId,
            method: 'GET',
            checkbar: true,
            checkbarType: "all",
            dot:false,
            icon: "2",
            initLevel: '3', //
            url: "${ctx}/menus/dtree/init?r_id=${(jsglrole.r_id)!''}" //异步接口
        });
        
	    $("#cancel").click(function(){
	        var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
	        parent.layer.close(index);
	    })
	    
	    form.on('submit(save)', function(data){
	        var paramStr = "";
	        var param = dtree.getCheckbarNodesParam(DemoTree);
	        param.forEach(function(e){  
	        	paramStr +=e.nodeId+"|"
	        });
	        if(paramStr == ""){
	        	layer.msg("请选择功能菜单",{offset:['50%'],time: 2000});
	        }else{
				data.field.paramStr = paramStr;
				var index;
	            $.ajax({
	    		    type: "post",
	    		    data: data.field,
	    		    url: '${ctx}/xtgl/qxgl/jsgl/role/add?flag=${flag}',
	    		    beforeSend: function () {
	    		    	index = layer.load(1);
	    		    },
	    		    success: function (data) {
	    		    	layer.close(index)
	    		    	var msg = "";
	    		    	if(data > 0){
	    		    		msg = "保存成功";
	    		    	}else{
	    		    		msg = "保存失败";
	    		    	}
	    		    	layer.msg(msg,{offset:['50%'],time: 1000},function(){
	    		    		index = parent.layer.getFrameIndex(window.name);
					    	parent.layer.close(index);
	                    });
	    		    },
	    		    error: function (data) {
	    		    	layer.close(index)
	    		    	layer.msg("服务器异常",{icon:2});
	    		    }
	    		});
	        }
	        return false;
        });
    })
</script>