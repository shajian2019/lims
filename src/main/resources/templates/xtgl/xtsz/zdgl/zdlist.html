<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>字典数据</title>
<link href="${ctx}/plugins/layui/css/layui.css" rel="stylesheet" />
<link href="${ctx}/plugins/font-awesome/css/font-awesome.css" rel="stylesheet" />
<style>
        .layui-table, .layui-table-view {
            margin: 8px 0 0;
        }
</style>
</head>
<body style="padding:8px 8px 0;">
        <div class="layui-inline">
            <a class="layui-btn layui-btn-primary" id="addBtn">新增</a>
        </div>
        <table class="layui-hide" id="tableBox" lay-filter="tableBox"></table>
    </body>
</html>
<script type="text/html" id="rightBar">
<div class="layui-btn-group">
	<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit"><i class="fa fa-pencil"></i></a>
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="del"><i class="fa fa-trash-o"></i></a>
</div>
</script>
<script src="${ctx}/plugins/layui/layui.all.js"></script>
<script>
    var $ = layui.jquery,
        table = layui.table,
        form = layui.form,
        tableId = 'tableBox',
        layer = layui.layer;
        table.render({
        elem: '#'+tableId,
        id:tableId,
        url:'${ctx}/xtgl/xtsz/zdgl/list?g_id=${params.g_id}',
        title: '字典数据',
        height:'full',
        cellMinWidth: 120,
        cols: [
            [{
                type: 'numbers',
                width: 50,
                title: '序号'
            }, {
                field: 'name',
                title: '字典标签'
            }, {
                field:'value',
                title: '字典键值',
            }, {
                field: 'sort',
                title: '排序号',
                width:100
            }, {
                field: 'createtime',
                title: '创建时间'
            }, {
                field: 'updatetime',
                title: '更新时间'
            },{
                field: 'remark',
                title: '备注信息'
            }, {
                title: '操作',
                width: 140,
                align:'center',
                templet: '#rightBar'
            }]
        ],
        page: true
    });
        
    table.on('tool(tableBox)', function (obj) {
        var data = obj.data;
        if (obj.event === 'edit') {
            layer.open({
	            type: 2,
	            area: ['690px', '445px'],
	            fixed: false, //不固定
	            maxmin: true,
	            content: '${ctx}/xtgl/xtsz/zdgl/zdpop?flag=edit&d_id='+data.d_id+"&g_id=${params.g_id}",
	            end: function(){
	            	table.reload(tableId)
	     		}
        	})
        }else if (obj.event === 'del') {
        	layer.confirm('是否删除字典数据？', function (index) {
                layer.close(index);
                var index;
    		    $.ajax({
    				    type: "post",
    				    data: {d_id:data.d_id},
    				    url: '${ctx}/xtgl/xtsz/zdgl/del',
    				    beforeSend: function () {
    				    	index = layer.load(1);
    				    },
    				    success: function (data) {
    				    	layer.close(index);
    				    	if(data > 0){
    				    		var msg = "删除成功";
    				    		layer.msg(msg,{offset:['50%'],time: 1000},function(){
    				    			table.reload(tableId)
    		                    });
    				    	}else{
    				    		layer.msg("操作失败")
    				    	}
    				    },
    				    error: function (data) {
    				    	layer.close(index);
    				    	layer.msg("服务端异常");
    				    }
    			 });
            });
        }
    })
    
    //添加
    $("#addBtn").click(function (e) { 
        layer.open({
            type: 2,
            area: ['690px', '445px'],
            fixed: false, //不固定
            maxmin: true,
            content: '${ctx}/xtgl/xtsz/zdgl/zdpop?flag=add&g_id=${params.g_id}',
            end: function(){
            	table.reload(tableId)
     		}
        })       
    });
</script>