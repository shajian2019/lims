<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>字典管理</title>
<link href="${ctx}/plugins/layui/css/layui.css" rel="stylesheet" />
<link href="${ctx}/plugins/font-awesome/css/font-awesome.css" rel="stylesheet" />
<style>
        .layui-table, .layui-table-view {
            margin: 8px 0 0;
        }
</style>
</head>
<body style="padding:8px 8px 0;">
        <form class="layui-form" action="">
            <div class="layui-inline">
                <input class="layui-input" type="text" placeholder="字典名称" name="name">
            </div>
            <div class="layui-inline">
                <input class="layui-input" type="text" placeholder="字典类型" name="gtype">
            </div>
            <div class="layui-input-inline">
                 <select name="status">
                     <option value="">状态</option>
                     <option value="1">正常</option>
                     <option value="0">停用</option>
                 </select>
            </div>
            <div class="layui-inline">
                <a class="layui-btn layui-btn-primary" lay-submit lay-filter="query">查询</a>
                <a class="layui-btn layui-btn-primary" id="addBtn">新增</a>
            </div>
        </form>
        <table class="layui-hide" id="tableBox" lay-filter="tableBox"></table>
    </body>
</html>
<script type="text/html" id="rightBar">
<div class="layui-btn-group">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit"><i class="fa fa-pencil"></i></a>
	<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="zd_data"><i class="fa fa-file-text"></i></a>
	<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="del"><i class="fa fa-trash-o"></i></a>
</div>
</script>

<script type="text/html" id="switch" >
	<input type="checkbox" name="switch" lay-skin="switch" lay-filter="switchstatus" lay-text="正常|停用" {{ d.status == '1' ? 'checked' : '' }}>
</script>

<script src="${ctx}/plugins/layui/layui.all.js"></script>
<script>
    var $ = layui.jquery,
        table = layui.table,
        form = layui.form,
        layer = layui.layer,
		tableId = 'tableBox';
        table.render({
	        elem: '#'+tableId,
	        id:tableId,
	        url:'${ctx}/xtgl/xtsz/zdgl/list?gtypef=gtypef',
	        title: '参数设置',
	        height:'full-55',
	        cellMinWidth: 120,
	        cols: [
	            [{
	                type: 'numbers',
	                width: 50,
	                title: '序号'
	            }, {
	                field: 'name',
	                title: '字典名称'
	            }, {
	                field:'gtype',
	                title: '字典类型',
	            }, {
	                field: 'createtime',
	                title: '创建时间'
	            }, {
	                field: 'updatetime',
	                title: '更新时间'
	            }, {
	                field: 'remark',
	                title: '备注信息'
	            },{
	                title: '状态',
	                templet:'#switch',
	                width:95,
	                align:'center'
	            }, {
	                title: '操作',
	                width: 100,
	                templet: '#rightBar'
	            }]
	        ],
	        page: true
    	});
    table.on('tool(tableBox)', function (obj) {
        var data = obj.data;
        if (obj.event === 'edit') {
            layer.open({
	            type: 2,
	            area: ['630px', '350px'],
	            fixed: false, //不固定
	            maxmin: true,
	            content: '${ctx}/xtgl/xtsz/zdgl/pop?flag=edit&d_id='+data.d_id,
	            end: function(){
	            	table.reload(tableId)
         		}
        	})
        } else if(obj.event==='zd_data'){
            var index=layer.open({
	            type: 2,
	            area: ['630px', '350px'],
	            fixed: false, //不固定
	            maxmin: true,
	            title:'字典数据',
	            content: '${ctx}/xtgl/xtsz/zdgl/zdlist?g_id='+data.d_id
	        });
        	layer.full(index);
        } else if (obj.event === 'del') {
            layer.confirm('是否删除字典数据？', function (index) {
                layer.close(index);
                var index;
    		    $.ajax({
    				    type: "post",
    				    data: {d_id:data.d_id},
    				    url: '${ctx}/xtgl/xtsz/zdgl/del',
    				    beforeSend: function () {
    				    	index = layer.load(1);
    				    },
    				    success: function (data) {
    				    	layer.close(index);
    				    	if(data > 0){
    				    		var msg = "删除成功";
    				    		layer.msg(msg,{offset:['50%'],time: 1000},function(){
    				    			table.reload(tableId)
    		                    });
    				    	}else{
    				    		layer.msg("操作失败")
    				    	}
    				    },
    				    error: function (data) {
    				    	layer.close(index);
    				    	layer.msg("服务端异常");
    				    }
    			 });
            });
        }
    })
    //查询
    form.on('submit(query)', function (data) {
    	table.reload(tableId, {
            where: data.field
        });
        return false;
    });
    
    //添加
    $("#addBtn").click(function (e) { 
        layer.open({
            type: 2,
            area: ['630px', '350px'],
            fixed: false, //不固定
            maxmin: true,
            content: '${ctx}/xtgl/xtsz/zdgl/pop?flag=add',
           	end: function(){
            	table.reload(tableId)
       		}
        })       
    });
</script>