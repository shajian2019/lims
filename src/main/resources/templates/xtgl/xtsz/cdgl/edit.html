<#assign ctx=req.contextPath />
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
 <link href="${ctx}/plugins/layui/css/layui.css" rel="stylesheet" />
 <link href="${ctx}/plugins/font-awesome/css/font-awesome.css" rel="stylesheet" />
 <style>
 /* layui重置 */
 .layui-form{width:530px;margin:10px auto 0;}
 .layui-form-item .layui-inline, .layui-form-item .layui-input-block{
    width:400px;
 }
 .layui-form-item .radio-box{border:1px solid #e6e6e6;}
 .layui-btn-container{width:512px;text-align:center;}
 /* 自定义 */
 div.icon-box{
    height: 36px;
    border:1px solid #e6e6e6;
    border-left:none;
    background-color: #fff;
    border-radius: 2px;
 }
 .icon-box .icon{
 	width: 36px;
 	height:36px;
 	text-align: center;
 	line-height: 36px;
 	border-right:1px solid #e6e6e6;
 	display: inline-block;
 }
 .icon-box .layui-inline-block{
 	display: flex;
 	align-items: center;
 	justify-content: space-between;
 }
 .icon-box .icon-input{
 	display: inline-block;
 	border:none; 
 	flex-grow: 1;
 	padding: 0 10px;
 }
</style>
</head>
<body>
<form class="layui-form layui-form-pane" lay-filter="edit" action="/menus/update">
	<#if params.action != 'add' && menu.level != '1'>
	    <div class="layui-form-item">
	        <label class="layui-form-label">上级菜单:</label>
	        <div class="layui-inline">
	            <input type="text" id="tree" lay-filter="tree" class="layui-input" name="parentid" lay-verify="required">
	        </div>
	    </div>
    </#if>
    <div class="layui-form-item">
        <label class="layui-form-label">菜单名称:</label>
        <div class="layui-inline">
            <input class="layui-input" type="text" name="title" value="<#if params.action != 'add'>${menu.title}</#if>" placeholder="菜单名称" lay-verify="required">
        </div>
    </div>
    <#if menu.level == '3'>
	    <div class="layui-form-item">
	        <label class="layui-form-label">链接(Href):</label>
	        <div class="layui-inline">
	            <input class="layui-input" type="text" name="url" value="${(menu.url)!''}">
	        </div>
	    </div>
    </#if>
    <div class="layui-form-item">
        <label class="layui-form-label">排序(升序):</label>
        <div class="layui-inline">
            <input class="layui-input" type="text" name="sort" value="<#if params.action != 'add'>${menu.sort}</#if>" placeholder="排序" lay-verify="required">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">菜单图标:</label>
        <div class="layui-inline icon-box">
            <div class="layui-inline-block">
            	<div class="icon">
	            	<#if params.action != 'add'>
			             <#if menu.level != '3'>
			                <i class="fa ${menu.icon} fa-fw"></i>
			            <#else>
			                <i class="layui-icon">${menu.icon}</i>
			            </#if>
			        </#if>
            	</div>
                <input type="text" name="icon" class="icon-input" value="<#if params.action != 'add'>${menu.icon?html}</#if>" lay-verify="required">
                <a class="layui-btn layui-btn-primary" id="icon_search" style="border-top:none;border-bottom: none;border-right:none;height:36px;line-height: 36px;padding: 0 15px;">
                	<i class="fa fa-search"></i>
                </a>
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">是否可见:</label>
        <div class="layui-input-block radio-box">
            <input type="radio" name="status" value="1" title="显示"<#if menu.status == '1'>checked</#if>>
            <input type="radio" name="status" value="0" title="隐藏"<#if menu.status == '0'>checked</#if>>
        </div>
    </div>
<div class="layui-btn-container">
  <a class="layui-btn layui-btn-sm layui-btn-primary" lay-submit lay-filter="save">保存</a>
  <a class="layui-btn layui-btn-sm layui-bg-gray" lay-filter="cancel">取消</a>
</div>
</form>
<script src="${ctx}/plugins/layui/layui.js"></script>
<script type="text/javascript">
//加载formSelect模块
layui.config({
    base: "${ctx}/plugins/layui/extend/"
	}).extend({
	    treeSelect: "treeSelect"
});
layui.use(['treeSelect','form','layer'],function(){
	var $=layui.jquery,treeSelect=layui.treeSelect,form=layui.form,layer=layui.layer;
	if(('${params.action}' != 'add' && ${menu.level} != 1)){
	    treeSelect.render({
	        elem: '#tree',
	        data: "${ctx}/menus/tree/init?level="+${menu.level},
	        type: 'get',
	        placeholder: '菜单名称',
	        search: true,
	        id: 'tree',
	        style: {
	            line: {
	                enable: true
	            }
	        },
	        click: function(d){
	        	console.log(d);
	            console.log(d.treeId); // 得到组件的id
	            console.log(d.current); // 得到点击节点的treeObj对象
	            console.log(d.data); // 得到组成树的数据
	        },
	        success: function (d) {
	           treeSelect.checkNode('tree', ${menu.parentid});
	           treeSelect.refresh('tree');
	        }
	    });
	}
	
	form.on('submit(save)', function(data){
		var action = '${params.action}';
		if('${params.action}' == 'edit'){
			data.field.id = '${menu.id}';
		}else{
			data.field.parentid = '${menu.parentid}';
		}
	    var index;
	    $.ajax({
			    type: "post",
			    data: data.field,
			    url: data.form.action,
			    beforeSend: function () {
			    	index = layer.load(1);
			    },
			    success: function (data) {
			    	layer.close(index);
			    	if(data > 0){
			    		var msg = "";
			    		if('${params.action}' == 'edit'){
			    			msg = "修改成功";
			    		}else{
			    			msg = "保存成功";
			    		}
			    		layer.msg(msg,{offset:['50%'],time: 1000},function(){
					    	index = parent.layer.getFrameIndex(window.name);
					    	parent.layer.close(index);
	                    });
			    	}else{
			    		layer.msg("操作失败")
			    	}
			    },
			    error: function (data) {
			    	layer.msg("操作异常");
			    }
		 });
	     return false;
    });
	
	//图标
	$("#icon_search").click(function(){
		var index = layer.open({
			  title:'图标库',
			  type: 2,
			  area: ['620px', '400px'],
			  fixed: false, //不固定
			  maxmin: true,
			  content:'${ctx}/xtgl/xtsz/cdgl/icon',
			  end: function(){
				  
			  }
		  });
	})
	
})


</script>
</body>
</html>
